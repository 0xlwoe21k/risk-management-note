# 高危名单

我们给我们的业务加上一条限制：每天登录失败超过100次，阻止登录。这个限制已经运行了好几天了，让我们看看过去三天每天拦下了谁

第一天

| 用户名 | 密码错误次数 |
| -- | -- |
| Jim | 100 |
| Tom | 90 |
| Lily | 10 |

第二天

| 用户名 | 密码错误次数 |
| -- | -- |
| Jim | 100 |
| Kate | 90 |
| Lily | 10 |

第三天

| 用户名 | 密码错误次数 |
| -- | -- |
| Jim | 100 |
| Jane | 20 |
| Pete | 5 |

发现什么了吗？

我们的Jim这个用户要么是不知道怎么找回密码，要么就是被黑客盯上了。

还有Lily这个用户，已经连续两天尝试了10次登录。虽然很可疑，但是比起Jim还是好很多。

### 提取高危名单

我们通过整理数据，经常会发现一些用户、手机号、银行卡号长期出现在我们的怀疑结果中，但是我们不能100%确定是否恶意，我们可以将这些数据会整理到单独的表中，根据其出现频率和行为严重程度整理为一个高危名单（有时称作灰名单）。

例如我们将上文中的数据整理为如下的高危名单

| 用户名 | 可疑程度 |
| -- | -- |
| Jim | ★★★★★★★★★★ |
| Lily | ★★★ |

等Jim明天访问我们的网站的时候，我们立刻阻止他登录，并进入全面的身份认证流程，即便他当天还没有登录失败过，但是他已经存在于我们的高危名单中，而且是头号可疑人物。

### 黑名单

当我们100%确定某条数据有问题的时候，我们给将它加入我们的黑名单库，也可以将这条数据相关的数据也都加入黑名单。当请求来自黑名单时，我们可以不进行更多的判定，直接让它尝尝最严格的认证，甚至完全阻止请求。

常见的黑名单有用户ID、设备号、手机号码、地址、银行卡号、IP、城市、国家等。

### 开放的名单

我们除了从自己公司的数据中统计高危名单，很多公司也将自己的开放了出来供别人查看。因为黑产通常会在不同网站重复使用一个手机号、IP、银行卡，使用开放数据意味着你不需要从头开始。

### 来自IDC的流量

在过去的工作中，我们检测到大量的恶意IP来自IDC机房，包括阿里云之类的公有云服务商。例如

| IP |
| -- |
| 42.156.128.1 |
| 42.156.128.2 |
| 42.156.128.3 |
| 42.156.128.4 |
| 42.156.128.5 |

这样的流量通过IP基本就可以断定是恶意流量了，因为用户的请求应该是从ISP的个人IP来，而IDC的流量往往是黑产服务器上的自动脚本。

对于这种情况可以将发现的IP加入黑名单，当然也可以直接将IP段加入黑名单。

### 了解更多

携程安全云 https://security.ctrip.com/

阿里云IP表 http://www.tcpiputils.com/browse/as/37963